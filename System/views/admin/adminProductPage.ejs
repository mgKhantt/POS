<%- contentFor('style') %>
<style>
    .product-page {
        padding: 30px;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .page-header h2 {
        font-size: 1.8rem;
        font-weight: 600;
    }

    .add-btn {
        background-color: #007bff;
        color: white;
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: 0.3s;
    }

    .add-btn:hover {
        background-color: #0056b3;
    }

    .search-bar {
        margin-bottom: 20px;
        display: flex;
        justify-content: flex-end;
    }

    .search-bar input {
        width: 250px;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        outline: none;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background-color: #fff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        border-radius: 8px;
        overflow: hidden;
    }

    th, td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
    }

    th {
        background-color: #f9fafb;
        font-weight: 600;
    }

    tr:hover {
        background-color: #f5f7fa;
    }

    /* ✅ Product image styling */
    .product-image {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .edit-btn, .delete-btn {
        padding: 6px 12px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .edit-btn {
        background-color: #17a2b8;
        color: white;
    }

    .edit-btn:hover {
        background-color: #138496;
    }

    .delete-btn {
        background-color: #dc3545;
        color: white;
    }

    .delete-btn:hover {
        background-color: #b52b39;
    }

    .empty-state {
        text-align: center;
        padding: 40px 0;
        color: #888;
    }
</style>

<%- contentFor('body') %>
<div class="product-page">
    <div class="page-header">
        <h2>Manage Products</h2>
        <button class="add-btn" onclick="location.href='/admin/products/create'">
            + Add Product
        </button>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search products..." onkeyup="filterProducts()">
    </div>

    <% if (products.length > 0) { %>
        <table id="productTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Product Name</th>
                    <th>Image</th>
                    <th>Category</th>
                    <th>Brand</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Code</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach((product, index) => { %>
                    <tr>
                        <td><%= index + 1 %></td>
                        <td><%= product.name %></td>
                        <td>
                            <img src="<%= product.imageUrl || '/uploads/no-image.png' %>" 
                                 alt="<%= product.name %>" 
                                 class="product-image">
                        </td>
                        <td><%= product.category %></td>
                        <td><%= product.brand %></td>
                        <td>$<%= product.price.toFixed(2) %></td>
                        <td><%= product.stock %></td>
                        <td><%= product.code %></td>
                        <td>
                            <div class="action-buttons">
                                <button class="edit-btn" onclick="location.href='/admin/products/edit/<%= product._id %>'">
                                    Edit
                                </button>
                                <button class="delete-btn" onclick="deleteProduct('<%= product._id %>')">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } else { %>
        <div class="empty-state">
            <p>No products found. Click “Add Product” to create one.</p>
        </div>
    <% } %>
</div>

<script>
    // Filter search
    function filterProducts() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('#productTable tbody tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(input) ? '' : 'none';
        });
    }

    // Delete confirmation
    function deleteProduct(id) {
        Swal.fire({
            title: "Are you sure?",
            text: "This product will be permanently deleted.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/admin/products/delete/${id}`, { method: 'DELETE' })
                    .then(res => res.json())
                    .then(data => {
                        Swal.fire("Deleted!", "Product has been deleted.", "success")
                            .then(() => location.reload());
                    })
                    .catch(err => console.error(err));
            }
        });
    }
</script>
